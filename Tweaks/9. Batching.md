# Batching

OPS = 并发度 * 计算用时

如何降低单路操作的延迟?

我们分两方面来讨论一下:

+ 读：对于读, 要降低其延迟, 一般方法是缓存, 即, 在请求真正到来之前, 将读请求需要的内容准备好. 典型的例子如PageCache/网站静态页面/数据库异构表, 如此, 我们减少了IO链路, 避免了不必要的计算, 从而最终降低了读操作的延迟. 
+ 写：对于写, 要降低其延迟, 一般方法是异步, 即, 将不必要的步骤放在关键路径之外来做. 

提到降低延迟, 还在一个很重要的方法, 即并行化. 

流水线化

如果我们的计算资源只支持单并发呢？比如硬盘、网卡. 对于此类延迟很高的计算, 我们根本没有办法来降低延迟. 相反, 我们需要接受它延迟高的现实, 并在此现实之上来构建我们的系统. 一般的, 我们需要足够的并发度, 打满其任务队列, 从而让其一直全功率工作. 然而, 事情还没有完, 仅仅这样并不能充分使用硬件. 对于这样高延迟的硬件, 每个任务的执行, 都会有非业务相关的开销, 比如read需要陷入内核、磁盘需要寻道, 这些额外开销累积后, 会严重影响性能. 因此, 我们需要聚合任务, 从而, 多个任务只需要付出一次额外的非业务相关的开销. 